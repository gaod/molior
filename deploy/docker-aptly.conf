# vim: syntax=sh

DEPLOYMENT_TYPE=docker
ARCH=amd64
TARGET_HOSTNAME=aptly
INSTALL_PACKAGE="aptly nginx-light supervisor"
DEPLOYMENT_COMPRESSION=none
CONTAINER_NAME=molior-aptly

postinst_deployment_docker()
{
  echo " * configuring aptly"
  echo "daemon off;" >$target/etc/nginx/modules-enabled/no-daemon.conf
  cp $SOURCE_DIR/deploy/docker/aptly-supervisord.conf $target/etc/supervisor/conf.d/aptly.conf
  cp $SOURCE_DIR/deploy/docker/aptly-start.sh $target/usr/local/bin/
  cp $SOURCE_DIR/deploy/docker/aptly-nginx-start.sh $target/usr/local/bin/

# FIX apt preferences
#
  # use public APT sources
  cat >$target/etc/apt/sources.list << EOF
deb http://deb.debian.org/debian $SUITE main
deb [arch=amd64,arm64] http://molior.info/1.4/$SUITE stable main
EOF
}
